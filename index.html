<!-- Single‑file deployable version (no build tools). Save as index.html and deploy. -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tap Logger</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style> .btn{ @apply rounded-2xl border border-neutral-200 bg-white px-3 py-2 text-sm hover:shadow-md hover:border-neutral-300 transition disabled:opacity-50; } </style>
  <meta name="theme-color" content="#111111" />
</head>
<body class="min-h-screen bg-neutral-50 text-neutral-900">
  <div class="max-w-4xl mx-auto p-4">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-2">
        <div class="w-2.5 h-2.5 rounded-full bg-green-500" id="netdot"></div>
        <h1 class="text-xl font-semibold">Tap Logger</h1>
        <span class="text-sm text-neutral-500">newest at top • cloud sync</span>
      </div>
      <div class="flex items-center gap-2" id="auth">
        <!-- filled by JS -->
      </div>
    </div>

    <!-- Quick buttons -->
    <div class="grid grid-cols-2 sm:grid-cols-5 gap-3 mb-4">
      <button class="btn" id="btnEat">eat (E)</button>
      <button class="btn" id="btnDrink">drink (D)</button>
      <button class="btn" id="btnFeel">feel (F)</button>
      <button class="btn" id="btnPosture">posture (P)</button>
      <button class="btn" id="btnNote">note (N)</button>
      <button class="btn" id="btnSync">sync</button>
      <button class="btn" id="btnExport">Export CSV</button>
    </div>

    <!-- Note entry panel -->
    <div id="noteBar" class="hidden mb-3 items-center gap-2 border border-neutral-200 bg-white p-3 rounded-xl">
      <span class="text-sm text-neutral-700">optional note:</span>
      <input id="noteInput" class="flex-1 outline-none bg-transparent" placeholder="type and press Enter" />
      <button class="btn" id="noteSave">Save</button>
      <button class="btn" id="noteCancel">Cancel</button>
    </div>

    <!-- Table -->
    <div class="rounded-2xl overflow-hidden border border-neutral-200 bg-white">
      <div class="grid grid-cols-6 text-xs font-semibold bg-neutral-50 border-b border-neutral-200">
        <div class="px-3 py-2">time</div>
        <div class="px-3 py-2">eat</div>
        <div class="px-3 py-2">drink</div>
        <div class="px-3 py-2">feel</div>
        <div class="px-3 py-2">posture</div>
        <div class="px-3 py-2">note</div>
      </div>
      <div id="rows"></div>
    </div>

    <div class="mt-4 text-xs text-neutral-500">
      Tips: Keyboard shortcuts <span class="font-mono">E/D/F/P/N</span>. Newest appears at the top.
    </div>
  </div>

  <!-- Supabase -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    // === Your Supabase project (public anon key is safe here) ===
    const SB_URL = 'https://ecmhraoczaxwsmuuvhhl.supabase.co';
    const SB_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjbWhyYW9jemF4d3NtdXV2aGhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4ODM5NDksImV4cCI6MjA3MDQ1OTk0OX0.M_eZR62DGXgmk4x0KfuSO8D-fsoy8GQMSkW4ay1-kDw';
    const supabase = createClient(SB_URL, SB_ANON);

    // === UI refs ===
    const authBox = document.getElementById('auth');
    const rowsEl = document.getElementById('rows');
    const netDot = document.getElementById('netdot');
    const noteBar = document.getElementById('noteBar');
    const noteInput = document.getElementById('noteInput');

    let session = null; // Supabase session
    let rows = [];      // local rows
    let pendingCol = null; // 'eat'|'drink'|'feel'|'posture'|'note' | null

    const pad = n => (n<10? '0':'')+n;
    const fmtTime = ts => { const d=new Date(ts); let h=d.getHours(); const m=pad(d.getMinutes()); const a=h>=12?'PM':'AM'; h=h%12||12; return `${h}:${m} ${a}`; };
    const fmtDate = ts => new Date(ts).toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'});

    function renderAuth(){
      authBox.innerHTML = '';
      if(!session){
        const input = Object.assign(document.createElement('input'), { placeholder:'email for magic link', className:'px-2 py-1 rounded-lg border border-neutral-300 text-sm', id:'email' });
        const btn = Object.assign(document.createElement('button'), { className:'btn', innerText:'Sign in'});
        btn.onclick = async ()=>{
          const email = input.value.trim();
          if(!email) return alert('Enter email');
          const { error } = await supabase.auth.signInWithOtp({ email, options:{ emailRedirectTo: window.location.origin } });
          if(error) alert(error.message); else alert('Check your email for the magic link.');
        };
        authBox.append(input, btn);
      } else {
        const out = Object.assign(document.createElement('button'), { className:'btn', innerText:'Sign out' });
        out.onclick = async ()=>{ await supabase.auth.signOut(); };
        authBox.append(out);
      }
    }

    function rowEl(r){
      const wrap = document.createElement('div');
      wrap.className = 'grid grid-cols-6 items-start text-sm border-b border-neutral-100 hover:bg-neutral-50';
      const del = () => { removeRow(r.id); };
      wrap.innerHTML = `
        <div class='px-3 py-2 whitespace-nowrap text-neutral-700'>${fmtTime(r.ts)}</div>
        <div class='px-3 py-2'>${r.eat||''}</div>
        <div class='px-3 py-2'>${r.drink||''}</div>
        <div class='px-3 py-2'>${r.feel||''}</div>
        <div class='px-3 py-2'>${r.posture||''}</div>
        <div class='px-3 py-2 flex items-center gap-2'><span class='flex-1 break-words'>${r.note||''}</span><button class='text-neutral-400 hover:text-red-600' aria-label='delete'>&#x2715;</button></div>`;
      wrap.querySelector('button').onclick = del;
      return wrap;
    }

    function render(){
      rowsEl.innerHTML='';
      if(!rows.length){
        const p=document.createElement('div'); p.className='p-6 text-sm text-neutral-500'; p.textContent='No entries yet. Tap a button above (or press E/D/F/P/N) to create a row with the current time.'; rowsEl.append(p); return;
      }
      let lastDay='';
      for(const r of rows){
        const day = fmtDate(r.ts);
        if(day!==lastDay){
          const d=document.createElement('div'); d.className='px-3 py-1 text-[11px] text-neutral-500 bg-neutral-50 border-t border-neutral-200'; d.textContent=day; rowsEl.append(d); lastDay=day;
        }
        rowsEl.append(rowEl(r));
      }
    }

    async function loadRows(){
      if(!session) return;
      const { data, error } = await supabase.from('logs').select('*').order('ts',{ascending:false});
      if(!error && data){ rows = data; render(); }
    }

    async function upsert(row){
      const { error } = await supabase.from('logs').upsert(row, { onConflict:'id' });
      if(error){ console.error(error); alert('Sync failed.'); }
    }

    async function removeRow(id){
      rows = rows.filter(r=> r.id!==id); render();
      await supabase.from('logs').delete().eq('id', id);
    }

    function newRow(col){
      if(!session) return alert('Sign in first.');
      const r = { id: crypto.randomUUID(), ts: Date.now(), user_id: session.user.id };
      rows = [r, ...rows]; render();
      pendingCol = col; noteInput.value=''; noteBar.classList.remove('hidden'); noteInput.focus();
    }

    function confirmNote(){
      const r = rows[0]; if(!r) return;
      if(pendingCol && pendingCol!=='note') r[pendingCol] = noteInput.value.trim() || '✔';
      if(pendingCol==='note') r.note = noteInput.value.trim();
      noteBar.classList.add('hidden'); pendingCol=null; render(); upsert(r);
    }

    function cancelNote(){ noteBar.classList.add('hidden'); pendingCol=null; noteInput.value=''; }

    // Export CSV
    async function exportCSV(){
      let data = rows;
      const res = await supabase.from('logs').select('*').order('ts',{ascending:false});
      if(!res.error && res.data) data = res.data;
      const headers = ['time','date','eat','drink','feel','posture','note'];
      const fmt = t => { const d=new Date(t); let h=d.getHours(); const m=('0'+d.getMinutes()).slice(-2); const a=h>=12?'PM':'AM'; h=h%12||12; return `${h}:${m} ${a}`; };
      const fdate = t => new Date(t).toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'});
      const lines = data.map(r=> [fmt(r.ts), fdate(r.ts), r.eat||'', r.drink||'', r.feel||'', r.posture||'', (r.note||'').replaceAll('
',' ')]);
      const csv = [headers, ...lines].map(arr=>arr.map(v=>`"${String(v).replaceAll('"','""')}"`).join(',')).join('
');
      const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`taplog-${new Date().toISOString().slice(0,10)}.csv`; a.click(); URL.revokeObjectURL(url);
    }

    // Online badge
    function updateNet(){ netDot.className = `w-2.5 h-2.5 rounded-full ${navigator.onLine? 'bg-green-500':'bg-gray-400'}`; }
    window.addEventListener('online', updateNet); window.addEventListener('offline', updateNet); updateNet();

    // Auth bootstrap
    supabase.auth.getSession().then(({data})=>{ session=data.session; renderAuth(); loadRows(); });
    supabase.auth.onAuthStateChange((_e, sess)=>{ session=sess; renderAuth(); loadRows(); });

    // Buttons
    document.getElementById('btnEat').onclick      = ()=> newRow('eat');
    document.getElementById('btnDrink').onclick    = ()=> newRow('drink');
    document.getElementById('btnFeel').onclick     = ()=> newRow('feel');
    document.getElementById('btnPosture').onclick  = ()=> newRow('posture');
    document.getElementById('btnNote').onclick     = ()=> { if(!session) return alert('Sign in first.'); rows=[{ id:crypto.randomUUID(), ts:Date.now(), user_id:session.user.id }, ...rows]; pendingCol='note'; noteInput.value=''; noteBar.classList.remove('hidden'); noteInput.focus(); render(); };
    document.getElementById('btnExport').onclick   = exportCSV;
    document.getElementById('btnSync').onclick     = loadRows;
    document.getElementById('noteSave').onclick    = confirmNote;
    document.getElementById('noteCancel').onclick  = cancelNote;
    noteInput.addEventListener('keydown', e=>{ if(e.key==='Enter') confirmNote(); });

    // Keyboard shortcuts
    window.addEventListener('keydown', e=>{
      const tag = (e.target && e.target.tagName)||''; if(tag==='INPUT' || tag==='TEXTAREA') return;
      const k = e.key.toLowerCase();
      if(k==='e') newRow('eat');
      if(k==='d') newRow('drink');
      if(k==='f') newRow('feel');
      if(k==='p') newRow('posture');
      if(k==='n') { if(!session) return alert('Sign in first.'); rows=[{ id:crypto.randomUUID(), ts:Date.now(), user_id: session.user.id }, ...rows]; pendingCol='note'; noteInput.value=''; noteBar.classList.remove('hidden'); noteInput.focus(); render(); }
    });
  </script>
</body>
</html>
import React, { useEffect, useMemo, useRef, useState } from "react";
import { Download, Trash2, Clock, Pencil, Check, X, Keyboard, Coffee, Apple, Activity, StretchHorizontal, LogIn, LogOut, RefreshCw } from "lucide-react";
import { createClient, Session } from "@supabase/supabase-js";

/**
 * Tap Logger – Supabase Cloud Sync Edition
 * - Newest rows always at the top (descending time)
 * - One‑tap log buttons (Eat / Drink / Feel / Posture)
 * - Email magic‑link login via Supabase (no password)
 * - Cloud persistence (works across phone/desktop)
 * - CSV export
 */

// ---------- Supabase init (uses env vars, falls back to your values) ----------
const SB_URL = (import.meta as any).env?.VITE_SB_URL || "https://ecmhraoczaxwsmuuvhhl.supabase.co";
const SB_ANON = (import.meta as any).env?.VITE_SB_ANON || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjbWhyYW9jemF4d3NtdXV2aGhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4ODM5NDksImV4cCI6MjA3MDQ1OTk0OX0.M_eZR62DGXgmk4x0KfuSO8D-fsoy8GQMSkW4ay1-kDw";
const supabase = createClient(SB_URL, SB_ANON);

// ---------- Helpers ----------
const pad = (n:number)=> (n<10?"0":"")+n;
const fmtTime = (ts:number)=>{ const d = new Date(ts); let h = d.getHours(); const m = pad(d.getMinutes()); const ampm = h>=12?"PM":"AM"; h = h%12 || 12; return `${h}:${m} ${ampm}`; };
const fmtDate = (ts:number)=> new Date(ts).toLocaleDateString(undefined,{ weekday: 'short', month:'short', day:'numeric' });

// Types
type ColKey = 'eat'|'drink'|'feel'|'posture';
interface LogRow { id: string; ts: number; user_id?: string; eat?: string; drink?: string; feel?: string; posture?: string; note?: string; }

const defaultCols: {key:ColKey, label:string, icon: React.ReactNode}[] = [
  { key: 'eat', label: 'eat', icon: <Apple className="w-4 h-4"/> },
  { key: 'drink', label: 'drink', icon: <Coffee className="w-4 h-4"/> },
  { key: 'feel', label: 'feel', icon: <Activity className="w-4 h-4"/> },
  { key: 'posture', label: 'posture', icon: <StretchHorizontal className="w-4 h-4"/> },
];

// CSV export
function toCSV(rows:LogRow[]) {
  const headers = ['time','date','eat','drink','feel','posture','note'];
  const lines = rows.map(r=>[
    fmtTime(r.ts), fmtDate(r.ts), r.eat||'', r.drink||'', r.feel||'', r.posture||'', (r.note||'').replaceAll('\n',' ')
  ]);
  return [headers, ...lines].map(arr=>arr.map(f=>`"${String(f).replaceAll('"','""')}"`).join(',')).join('\n');
}

export default function App(){
  const [session, setSession] = useState<Session|null>(null);
  const [loading, setLoading] = useState(true);
  const [email, setEmail] = useState("");
  const [rows, setRows] = useState<LogRow[]>([]);
  const [quickNote, setQuickNote] = useState('');
  const [askNote, setAskNote] = useState<boolean>(false);
  const [pendingCol, setPendingCol] = useState<ColKey|'note'|null>(null);
  const [syncing, setSyncing] = useState(false);
  const topRef = useRef<HTMLDivElement>(null);

  // --- auth bootstrap ---
  useEffect(()=>{
    supabase.auth.getSession().then(({ data })=>{ setSession(data.session||null); setLoading(false); });
    const { data: sub } = supabase.auth.onAuthStateChange((_evt, sess)=> setSession(sess));
    return ()=> sub.subscription.unsubscribe();
  },[]);

  // --- fetch logs when session ready ---
  useEffect(()=>{ if(!session) { setRows([]); return; } (async()=>{ setSyncing(true); const { data, error } = await supabase.from('logs').select('*').order('ts', { ascending:false }); if(!error && data){ setRows(data as any); } setSyncing(false); })(); },[session]);

  // Local cache (so a refresh on phone doesn’t lose view)
  useEffect(()=>{ try{ localStorage.setItem('taplogger.cache', JSON.stringify(rows)); }catch{} },[rows]);
  useEffect(()=>{ if(!rows.length){ try{ const raw = localStorage.getItem('taplogger.cache'); if(raw) setRows(JSON.parse(raw)); }catch{} } },[]);

  const sorted = useMemo(()=> [...rows].sort((a,b)=> b.ts - a.ts), [rows]);

  // --- actions ---
  const addRow = async (col:ColKey, autoAsk=true)=>{
    if(!session){ alert('Please sign in first (email magic link).'); return; }
    const ts = Date.now();
    const draft: LogRow = { id: crypto.randomUUID(), ts, user_id: session.user.id, [col]: '' } as LogRow;
    // optimistic UI
    setRows(prev=> [draft, ...prev]);
    if (autoAsk){ setPendingCol(col); setAskNote(true); setQuickNote(''); }
    setTimeout(()=> topRef.current?.scrollIntoView({ behavior:'smooth' }), 40);
  };

  const addNoteToLast = async (text:string)=>{
    if(!session) return;
    const latest = sorted[0];
    if(!latest) return;
    const updated: LogRow = { ...latest };
    if (pendingCol && pendingCol!=='note') updated[pendingCol] = text || '✔';
    if (pendingCol==='note') updated.note = text;
    setRows(prev=> [updated, ...prev.slice(1)]);
    // persist to supabase
    const { error } = await supabase.from('logs').upsert(updated, { onConflict: 'id' });
    if(error){ console.error(error); alert('Sync failed; will retry on refresh.'); }
  };

  const confirmNote = ()=>{ addNoteToLast(quickNote.trim()); setAskNote(false); setPendingCol(null); setQuickNote(''); };
  const cancelNote = ()=>{ setAskNote(false); setPendingCol(null); setQuickNote(''); };
  const addFreeNote = ()=>{ if(!session){ alert('Sign in first.'); return; } setPendingCol('note'); setAskNote(true); setQuickNote(''); };

  const removeRow = async (id:string)=>{
    setRows(prev=> prev.filter(r=> r.id!==id));
    if(session){ await supabase.from('logs').delete().eq('id', id); }
  };

  const exportFile = async ()=>{
    setSyncing(true);
    let data = sorted;
    if(session){ const res = await supabase.from('logs').select('*').order('ts',{ascending:false}); if(!res.error && res.data) data = res.data as any; }
    const csv = toCSV(data);
    const blob = new Blob([csv],{ type:'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `taplog-${new Date().toISOString().slice(0,10)}.csv`;
    a.click(); URL.revokeObjectURL(url); setSyncing(false);
  };

  // --- auth actions ---
  const signIn = async ()=>{
    if(!email) return;
    const { error } = await supabase.auth.signInWithOtp({ email, options: { emailRedirectTo: window.location.origin } });
    if(error) alert(error.message); else alert('Check your email for the magic link.');
  };
  const signOut = async ()=>{ await supabase.auth.signOut(); };

  // keyboard shortcuts
  useEffect(()=>{
    const onKey = (e:KeyboardEvent)=>{
      const tag = (e.target as HTMLElement)?.tagName;
      if (tag === 'INPUT' || tag === 'TEXTAREA') return;
      const k = e.key.toLowerCase();
      if (k==='e') addRow('eat');
      if (k==='d') addRow('drink');
      if (k==='f') addRow('feel');
      if (k==='p') addRow('posture');
      if (k==='n') addFreeNote();
    };
    window.addEventListener('keydown', onKey);
    return ()=> window.removeEventListener('keydown', onKey);
  },[session]);

  // ---------- UI ----------
  return (
    <div className="min-h-screen bg-neutral-50 text-neutral-900">
      <div className="max-w-4xl mx-auto px-4 py-6">
        <div className="flex items-center justify-between gap-3 mb-4">
          <div className="flex items-center gap-2">
            <Clock className="w-5 h-5"/>
            <h1 className="text-xl font-semibold">Tap Logger</h1>
            <span className="text-sm text-neutral-500">newest at top • cloud sync</span>
          </div>
          <div className="flex items-center gap-2">
            <button onClick={exportFile} className="px-3 py-1.5 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 flex items-center gap-2"><Download className="w-4 h-4"/>{syncing? 'Exporting…':'Export CSV'}</button>
            {session ? (
              <button onClick={signOut} className="px-3 py-1.5 rounded-lg border border-neutral-300 hover:bg-neutral-100 flex items-center gap-2"><LogOut className="w-4 h-4"/>Sign out</button>
            ):(
              <div className="flex items-center gap-2">
                <input value={email} onChange={e=>setEmail(e.target.value)} placeholder="email for magic link" className="px-2 py-1 rounded-lg border border-neutral-300 text-sm"/>
                <button onClick={signIn} className="px-3 py-1.5 rounded-lg border border-neutral-300 hover:bg-neutral-100 flex items-center gap-2"><LogIn className="w-4 h-4"/>Sign in</button>
              </div>
            )}
          </div>
        </div>

        {/* Quick log buttons */}
        <div className="grid grid-cols-2 sm:grid-cols-5 gap-3 mb-4">
          {defaultCols.map(c=> (
            <button key={c.key} onClick={()=>addRow(c.key)} disabled={!session} className="rounded-2xl shadow-sm bg-white border border-neutral-200 hover:shadow-md hover:border-neutral-300 transition p-3 flex flex-col items-center gap-1 disabled:opacity-50">
              <div className="text-neutral-700">{c.icon}</div>
              <div className="text-sm font-medium">{c.label}</div>
              <div className="text-[11px] text-neutral-500">press {c.key[0]}</div>
            </button>
          ))}
          <button onClick={addFreeNote} disabled={!session} className="rounded-2xl shadow-sm bg-white border border-neutral-200 hover:shadow-md hover:border-neutral-300 transition p-3 flex flex-col items-center gap-1 disabled:opacity-50">
            <Keyboard className="w-4 h-4 text-neutral-700"/>
            <div className="text-sm font-medium">note</div>
            <div className="text-[11px] text-neutral-500">press n</div>
          </button>
          <button onClick={()=>{setSyncing(true); supabase.from('logs').select('*').order('ts',{ascending:false}).then(({data})=>{ if(data) setRows(data as any); setSyncing(false);});}} disabled={!session} className="rounded-2xl shadow-sm bg-white border border-neutral-200 hover:shadow-md hover:border-neutral-300 transition p-3 flex flex-col items-center gap-1 disabled:opacity-50">
            <RefreshCw className="w-4 h-4 text-neutral-700"/>
            <div className="text-sm font-medium">sync</div>
            <div className="text-[11px] text-neutral-500">pull latest</div>
          </button>
        </div>

        {/* Ask for optional note */}
        {askNote && (
          <div className="mb-4 rounded-xl border border-neutral-200 bg-white p-3 flex items-center gap-2">
            <Pencil className="w-4 h-4 text-neutral-700"/>
            <input autoFocus value={quickNote} onChange={e=>setQuickNote(e.target.value)} placeholder="optional note (enter to save)" className="flex-1 outline-none bg-transparent"/>
            <button onClick={confirmNote} className="px-2 py-1 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800"><Check className="w-4 h-4"/></button>
            <button onClick={cancelNote} className="px-2 py-1 rounded-lg border border-neutral-300 hover:bg-neutral-100"><X className="w-4 h-4"/></button>
          </div>
        )}

        {/* Table */}
        <div ref={topRef}/>
        <div className="rounded-2xl overflow-hidden border border-neutral-200 bg-white">
          <div className="grid grid-cols-6 text-xs font-semibold bg-neutral-50 border-b border-neutral-200">
            <div className="px-3 py-2">time</div>
            <div className="px-3 py-2">eat</div>
            <div className="px-3 py-2">drink</div>
            <div className="px-3 py-2">feel</div>
            <div className="px-3 py-2">posture</div>
            <div className="px-3 py-2">note</div>
          </div>
          <div>
            {!session && (
              <div className="p-6 text-sm text-neutral-600">Sign in with your email (magic link) to start logging. Your entries will sync across phone & desktop automatically.</div>
            )}
            {sorted.length===0 && session && (
              <div className="p-6 text-sm text-neutral-500">No entries yet. Tap a button above (or press E/D/F/P/N) to create a row with the current time.</div>
            )}
            {sorted.map((r,idx)=>{
              const prev = sorted[idx-1];
              const newDay = !prev || new Date(prev.ts).toDateString()!==new Date(r.ts).toDateString();
              return (
                <React.Fragment key={r.id}>
                  {newDay && (
                    <div className="px-3 py-1 text-[11px] text-neutral-500 bg-neutral-50 border-t border-neutral-200">{fmtDate(r.ts)}</div>
                  )}
                  <div className="grid grid-cols-6 items-start text-sm border-b border-neutral-100 hover:bg-neutral-50">
                    <div className="px-3 py-2 whitespace-nowrap text-neutral-700">{fmtTime(r.ts)}</div>
                    <div className="px-3 py-2">{r.eat || ''}</div>
                    <div className="px-3 py-2">{r.drink || ''}</div>
                    <div className="px-3 py-2">{r.feel || ''}</div>
                    <div className="px-3 py-2">{r.posture || ''}</div>
                    <div className="px-3 py-2 flex items-center gap-2">
                      <span className="flex-1 break-words">{r.note||''}</span>
                      <button title="delete row" onClick={()=>removeRow(r.id)} className="text-neutral-400 hover:text-red-600"><Trash2 className="w-4 h-4"/></button>
                    </div>
                  </div>
                </React.Fragment>
              );
            })}
          </div>
        </div>

        <div className="mt-4 text-xs text-neutral-500">
          Tips: Use keyboard shortcuts <span className="font-mono">E/D/F/P/N</span>. Newest rows always appear at the top. Data syncs to your Supabase project.
        </div>
      </div>
    </div>
  );
}
